(function(){L.PiechartIcon=L.CanvasIcon.extend({options:{iconSize:[48,48],iconAnchor:[24,24],popupAnchor:[24,24],className:"leaflet-piechart-icon",valueField:"value",nameField:"name"},_setIconStyles:function(n,j){var e=this.options.data;if((j=="icon")&&e&&L.Util.isArray(e)&&n.getContext){var r=n.getContext("2d");var s=L.point(this.options.iconSize);var a=s.divideBy(2);r.clearRect(0,0,s.x,s.y);var q=this.options.valueField;var m=this._getTotal(e,q);var o=a.x;var k=a.y;if(m){var g=Math.min(o,k);var p=Math.PI/m*2;var h=-Math.PI/2;var f;var b;for(var d=0,c=e.length;d<c;d++){r.beginPath();b=e[d].style||this._getStyle(d,c);this._applyStyle(r,b);f=p*e[d][q]+h;r.arc(o,k,g-Math.ceil((b.lineWidth||0)/2),h,f);r.stroke();r.lineTo(o,k);h=f;r.fill();r.closePath()}}}L.CanvasIcon.prototype._setIconStyles.apply(this,arguments)},_getTotal:function(d,e){var c=0;for(var b=0,a=d.length;b<a;b++){c+=(+d[b][e])}return c},_applyStyle:function(a,c){for(var b in c){a[b]=c[b]}},_getStyle:function(d,c){var g=function(o,v,n){var i,t,u;if(v==0){i=t=u=n}else{var m=function(r,l,h){if(h<0){h+=1}if(h>1){h-=1}if(h<1/6){return r+(l-r)*6*h}if(h<1/2){return l}if(h<2/3){return r+(l-r)*(2/3-h)*6}return r};var j=n<0.5?n*(1+v):n+v-n*v;var k=2*n-j;i=m(k,j,o+1/3);t=m(k,j,o);u=m(k,j,o-1/3)}return Math.round(i*255)+","+Math.round(t*255)+","+Math.round(u*255)};var f=360/(c*2.5);var e=(d%2)*c;var a=(f*(e+(d-(d%2))))/360;var b=g(a,0.7,0.5);return{fillStyle:"rgba("+b+",.5)",strokeStyle:"rgba("+b+",.7)",lineWidth:1}}});L.piechartIcon=function(a){return new L.PiechartIcon(a)};L.PiechartMarker=L.Marker.extend({options:{icon:null,radius:20,riseOnHover:true},initialize:function(d,a){var c={};L.Util.extend(c,a);if(c.radius){var b=c.radius*2;c.iconSize=[b,b];c.iconAnchor=[c.radius,c.radius]}c.icon=L.piechartIcon(c);L.Marker.prototype.initialize.apply(this,[d,c])}});L.piechartMarker=function(b,a){return new L.PiechartMarker(b,a)}}());